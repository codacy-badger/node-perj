'use strict';const symApplyOptions=Symbol('ApplyOptions'),symTopAsString=Symbol('TopAsString'),symHeaders=Symbol('Headers'),symLogAssignment=Symbol('LogAssignment'),defaultOptions={levels:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},level:'info',levelNumberKey:'lvl',dateTimeKey:'time',messageKey:'msg',dataKey:'data',write:process.stdout.write.bind(process.stdout)};module.exports=Object.freeze({create(a){return new Jrep(a)}});class Jrep{constructor(a){this[symApplyOptions](a)}[symApplyOptions](a){const b=splitOptions(a);this.options=Object.freeze(b.options),this.top=Object.freeze(b.top),this[symTopAsString]=b.topAsString,this[symHeaders]={},this[symLogAssignment]()}[symLogAssignment](){Object.keys(this.options.levels).forEach(a=>{this[symHeaders][a]=`{"level":"${a}","${this.options.levelNumberKey}":${this.options.levels[a]}${this[symTopAsString]},"${this.options.dateTimeKey}":`,this[a]=function(...b){if(this.options.levels[this.options.level]>this.options.levels[a])return;let c=this[symHeaders][a]+new Date().getTime();const d=stringifyLogItems(b);c+=',"'+this.options.messageKey+'":'+d.msg,c+=',"'+this.options.dataKey+'":'+d.data+'}\n',this.options.write(c)}})}child(a){const b=Object.assign({},this.options,this.top,a),c=Object.create(this);return c[symApplyOptions](b),c.parent=this,c}stringify(a,b,c){this.options.write(stringify(a,b,c))}json(a){this.options.write(stringify(a,null,2))}}function splitOptions(a){let b={options:defaultOptions,top:{},topAsString:''};if(!a)return b;b.options=Object.assign({},defaultOptions,a);let c=[];for(const d in b.options)Object.keys(defaultOptions).includes(d)||c.push(d);if(1>c.length)return b;for(const d of c)b.top[d]=b.options[d],b.topAsString+=',"'+d+'":'+stringify(b.options[d]),delete b.options[d];return b}function stringifyLogItems(a){let b={msg:'',data:[]};for(const c of a){if('[object String]'===Object.prototype.toString.call(c)){b.msg?b.data.push(c):b.msg=c;continue}if(c instanceof Error){b.data.push(serializerr(c)),b.msg||(b.msg=c.message);continue}b.data.push(c)}return 1>b.data.length?b.data='':1===b.data.length&&(b.data=b.data[0]),b.msg=stringify(b.msg),b.data=stringify(b.data),b}const arr=[];function stringify(a,b,c){decirc(a,'',[],void 0);const d=JSON.stringify(a,b,c);for(;0!==arr.length;){const a=arr.pop();a[0][a[1]]=a[2]}return d}function decirc(a,b,c,d){let e;if('object'==typeof a&&null!==a){for(e=0;e<c.length;e++)if(c[e]===a)return d[b]='[Circular]',void arr.push([d,b,a]);if(c.push(a),Array.isArray(a))for(e=0;e<a.length;e++)decirc(a[e],e,c,a);else{const b=Object.keys(a);for(e=0;e<b.length;e++){const d=b[e];decirc(a[d],d,c,a)}}c.pop()}}function serializerr(a={}){const b=protochain(a).filter(a=>a!==Object.prototype);return[a].concat(b).map(a=>Object.getOwnPropertyNames(a)).reduce((b,c)=>(c.forEach(c=>{b[c]=a[c]}),b),{})}function protochain(a){const b=[];for(let c=getPrototypeOf(a);c;)b.push(c),c=getPrototypeOf(c);return b}function getPrototypeOf(a){return null==a?null:Object.getPrototypeOf(Object(a))}
